# 開発用Dockerfile
FROM ubuntu:24.04

# パッケージリストを更新し、必要なライブラリをインストール
RUN apt-get update && apt-get install -y \
    golang-1.21 \
    git \
    build-essential \
    pkg-config \
    libopencv-dev \
    libopencv-contrib-dev \
    curl \
    wget \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

# Goのパスを設定
ENV PATH="/usr/lib/go-1.21/bin:${PATH}"
ENV GOPATH="/go"
ENV GOROOT="/usr/lib/go-1.21"

# 作業ディレクトリを設定
WORKDIR /app

# Go modulesファイルをコピー
COPY go.mod go.sum ./

# 依存関係をダウンロード
RUN go mod download

# ソースコードをコピー
COPY . .

# ポート8080を公開
EXPOSE 8080

# 開発用コマンド（ホットリロード）
CMD ["air", "-c", ".air.toml"]
